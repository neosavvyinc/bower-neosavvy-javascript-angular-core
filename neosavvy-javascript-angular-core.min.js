/*! neosavvy-javascript-angular-core - v0.0.2 - 2013-10-01
* Copyright (c) 2013 Neosavvy, Inc.; Licensed  */
var Neosavvy=Neosavvy||{};Neosavvy.AngularCore=Neosavvy.AngularCore||{},Neosavvy.AngularCore.Directives=angular.module("neosavvy.angularcore.directives",[]),Neosavvy.AngularCore.Filters=angular.module("neosavvy.angularcore.filters",[]),Neosavvy.AngularCore.Services=angular.module("neosavvy.angularcore.services",[]),Neosavvy.AngularCore.Directives.directive("nsInlineHtml",["$compile",function(a){return{restrict:"E",template:"<div></div>",replace:!0,scope:!1,link:function(b,c,d){if(!d.hasOwnProperty("value"))throw"You must provide an html value on the scope in order to bind inline html!";var e=d.$observe("value",function(d){d&&(a(c.replaceWith(d))(b),e())})}}}]),Neosavvy.AngularCore.Directives.directive("nsStaticInclude",["$http","$templateCache","$compile",function(a,b,c){return{restrict:"E",template:"<div></div>",replace:!0,scope:!1,compile:function(d,e){if(_.isEmpty(e.src))throw"You must pass in a source to render a Neosavvy static include directive.";var f=e.waitFor,g=e.watchWaitFor,h=e.waitForRender,i=e.watchWaitForRender;return _.isEmpty(f)&&_.isEmpty(g)&&(a.get(e.src,{cache:b}),_.isEmpty(i)?_.isEmpty(h)||(f=h):g=i),function(d,e,h){var i,j=function(a){e.replaceWith(c(angular.element(a.data))(d))},k=function(){a.get(h.src,{cache:b}).then(j),i&&i()};_.isEmpty(g)?!_.isEmpty(f)&&parseFloat(f)>0?setTimeout(k,parseFloat(f)):k():i=d.$watch(g,function(a){angular.isDefined(a)&&k()})}}}}]),Neosavvy.AngularCore.Directives.directive("nsEvent",["$rootScope",function(){return{restrict:"A",scope:!1,link:function(a,b,c){function d(a){return a.match(/.*?(?=\(|$)/i)[0]}function e(a,b){if(_.isUndefined(a[d(b)])){if(a.$parent)return e(a.$parent,b);throw"Your handler method has not been found in the scope chain, please add "+b+" to the scope chain!"}return a}function f(b){var c=e(a,g[1]);c.$event=b,c.$apply(function(){c[g[1]]()})}var g=c.nsEvent.replace(/ /g,"").split(","),h=_.isUndefined(c.nsEventHighPriority)?!1:!0;if(g.length<2)throw"Specify an event and handler in order to use the ns-event directive!";if(2===g.length)h?b.bindFirst(g[0],f):b.bind(g[0],f);else for(var i=2;i<g.length;i++){var j=$(b).find(g[i]);h?j.bindFirst(g[0],f):j.bind(g[0],f)}}}}]),Neosavvy.AngularCore.Directives.directive("nsModelOnBlur",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){"radio"!==c.type&&"checkbox"!==c.type&&(b.unbind("input").unbind("keydown").unbind("change"),b.bind("blur",function(){a.$apply(function(){d.$setViewValue(b.val())})}))}}}),Neosavvy.AngularCore.Filters.filter("nsCollectionFilterProperties",function(){return function(a,b,c){return a&&c?a.filter(function(a){return-1!==c.indexOf(Neosavvy.Core.Utils.MapUtils.get(a,b))}):a}}),Neosavvy.AngularCore.Filters.filter("nsCollectionFilterPropertyContains",function(){return function(a,b,c){return a&&c?a.filter(function(a){return-1!==String(Neosavvy.Core.Utils.MapUtils.get(a,b)).toLowerCase().indexOf(String(c).toLowerCase())}):a}}),Neosavvy.AngularCore.Filters.filter("nsCollectionFilterProperty",function(){return function(a,b,c){return a&&c?a.filter(function(a){return Neosavvy.Core.Utils.MapUtils.get(a,b)===c}):a}}),Neosavvy.AngularCore.Filters.filter("nsCollectionNumericExpression",["$parse",function(a){return function(b,c,d){return b&&b.length?c&&c.length?b.filter(function(b){for(var e=0;e<c.length;e++){var f=c[e],g=f.expression;/</.test(g)||/>/.test(g)||(g=g.replace(/=/g,"=="));var h=d?b[parseInt(f.index)][d]:b[parseInt(f.index)];if(g&&/\d/.test(g)&&!a(String(h)+g)())return!1}return!0}):b:[]}}]),Neosavvy.AngularCore.Filters.filter("nsCollectionPage",function(){return function(a,b,c){if(a&&a.length){if(void 0!==b&&c){var d=b*c;return a.slice(d,Math.min(d+c,a.length))}}else a=[];return a}}),Neosavvy.AngularCore.Filters.filter("nsLogicalIf",function(){return function(a,b,c){return a?b:c}}),Neosavvy.AngularCore.Filters.filter("nsTextReplace",function(){return function(a){if(!_.isEmpty(a)&&arguments.length>1)for(var b=1;b<arguments.length;b++)a=a.replace(new RegExp(arguments[b],"g"),"");return a}}),Neosavvy.AngularCore.Filters.filter("nsTruncate",function(){return function(a,b){return!_.isEmpty(a)&&b<a.length&&(a=a.slice(0,b)+"..."),a}}),function(a){function b(b){return h?b.data("events"):a._data(b[0]).events}function c(a,c,d){var e=b(a),f=e[c];if(!h){var g=d?f.splice(f.delegateCount-1,1)[0]:f.pop();return f.splice(d?0:f.delegateCount||0,0,g),void 0}d?e.live.unshift(e.live.pop()):f.unshift(f.pop())}function d(b,d,e){var f=d.split(/\s+/);b.each(function(){for(var b=0;b<f.length;++b){var d=a.trim(f[b]).match(/[^\.]+/i)[0];c(a(this),d,e)}})}var e=a.fn.jquery.split("."),f=parseInt(e[0]),g=parseInt(e[1]),h=1>f||1==f&&7>g;a.fn.bindFirst=function(){var b=a.makeArray(arguments),c=b.shift();return c&&(a.fn.bind.apply(this,arguments),d(this,c)),this},a.fn.delegateFirst=function(){var b=a.makeArray(arguments),c=b[1];return c&&(b.splice(0,2),a.fn.delegate.apply(this,arguments),d(this,c,!0)),this},a.fn.liveFirst=function(){var b=a.makeArray(arguments);return b.unshift(this.selector),a.fn.delegateFirst.apply(a(document),b),this},h||(a.fn.onFirst=function(b,c){var e=a(this),f="string"==typeof c;if(a.fn.on.apply(e,arguments),"object"==typeof b)for(type in b)b.hasOwnProperty(type)&&d(e,type,f);else"string"==typeof b&&d(e,b,f);return e})}(jQuery),Neosavvy.AngularCore.Services.factory("nsServiceExtensions",["$q","$http",function(a,b){function c(a){var b,c,d,e={};return a?(forEach(a.split("\n"),function(a){d=a.indexOf(":"),b=lowercase(trim(a.substr(0,d))),c=trim(a.substr(d+1)),b&&(e[b]?e[b]+=", "+c:e[b]=c)}),e):e}function d(a){if(a.cache&&"GET"===a.method){var b=a.cache.get(a.url);if(b&&b.length)return b}return void 0}function e(a,b,d,e){a.cache&&"GET"===a.method&&a.cache.put(a.url,[b,d,c(e)])}return{request:function(c,d,e){if(!c.method)throw"You must provide a method for each service request.";if(!c.url)throw"You must provide a url for each service request.";var f=a.defer();return b(c).success(function(a){f.resolve(a),d&&d(a)}).error(function(a){f.reject(a),e&&e(a)}),f.promise},xhr:function(a){if(!a.method)throw"You must provide a method for each service request.";if(!a.url)throw"You must provide a url for each service request.";var b=Q.defer(),c=d(a);if(c)b.resolve(c[1]);else{var f=new XMLHttpRequest;f.onreadystatechange=function(){if(4===f.readyState){var c=f.responseText;200===f.status?(e(a,f.status,c,f.getAllResponseHeaders()),a.transformResponse?c=a.transformResponse(c):"application/json"===f.getResponseHeader("Content-Type")&&(c=JSON.parse(c)),b.resolve(c,f.status,f.getAllResponseHeaders())):b.reject(c,f.status,f.getAllResponseHeaders())}},f.onerror=function(){b.reject(f,f.status,f.getAllResponseHeaders())};var g=a.data;g&&(a.transformRequest?g=a.transformRequest(g):_.isString(g)||(g=JSON.stringify(g))),f.open(a.method,a.url,!0),f.send(g)}return b.promise}}}]);